<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PBM Admin Vault</title>
    <link rel="icon" type="image/svg+xml" href="https://upload.wikimedia.org/wikipedia/commons/5/53/Pok%C3%A9_Ball_icon.svg">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap" rel="stylesheet">
    <style>
        :root { --bg: #0a0a15; --card: rgba(26,26,46,0.95); --accent: #00eeff; --purple: #9d4edd; --text: #ffffff; --gold: #ffd700; }
        body { background: var(--bg); color: var(--text); font-family: 'Inter', sans-serif; padding: 1.5rem; min-height: 100vh; margin: 0; }
        .container { max-width: 700px; margin: 0 auto; }
        h1 { text-align: center; color: var(--accent); margin-bottom: 2rem; font-weight: 900; font-size: 2rem; text-shadow: 0 0 20px var(--accent); }
        .card { background: var(--card); padding: 1.5rem; border-radius: 16px; border: 1px solid rgba(0,238,255,0.2); margin-bottom: 1.5rem; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        label { display: block; margin-bottom: 0.5rem; color: #aaa; font-weight: 600; font-size: 0.85rem; }
        input, select { width: 100%; padding: 12px; margin-bottom: 1rem; background: rgba(0,0,0,0.5); border: 1px solid #444; color: white; border-radius: 8px; font-size: 1rem; box-sizing: border-box; }
        input:focus, select:focus { outline: none; border-color: var(--accent); }
        button { width: 100%; padding: 1rem; background: linear-gradient(135deg, var(--accent), var(--purple)); color: white; font-weight: 900; border: none; border-radius: 8px; cursor: pointer; text-transform: uppercase; letter-spacing: 1px; }
        ul { padding: 0; margin: 0; list-style: none; }
        li { background: rgba(255,255,255,0.05); padding: 1.5rem; margin-bottom: 1rem; border-radius: 12px; border: 1px solid rgba(255,255,255,0.1); }
        .item-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 10px; }
        .item-title { font-weight: 900; font-size: 1.2rem; }
        .badge { padding: 4px 8px; font-size: 0.7rem; border-radius: 4px; font-weight: 800; text-transform: uppercase; margin-left: 5px; }
        .b-auc { background: var(--purple); color: white; }
        .btn-group { display: flex; gap: 10px; margin-top: 15px; }
        .btn-group button { padding: 8px; font-size: 0.8rem; }
        #login-section { display: block; } #admin-section { display: none; }
        .history-panel { background: #000; padding: 10px; border-radius: 8px; margin-top: 10px; display: none; border: 1px solid var(--purple); }
    </style>
</head>
<body>
    <div class="container">
        <h1>PBM ADMIN</h1>
        <div id="login-section" class="card">
            <label>Username</label><input type="text" id="login-username">
            <label>Password</label><input type="password" id="login-password">
            <button onclick="login()">LOGIN</button>
        </div>
        <div id="admin-section">
            <div class="card">
                <label>Name</label><input type="text" id="item-name">
                <label>Description</label><input type="text" id="item-description">
                <div style="display:flex; gap:10px;">
                    <div style="flex:1"><label>Mode</label><select id="item-price-type"><option value="fixed">Fixed</option><option value="auction">Auction</option></select></div>
                    <div style="flex:1"><label>Price</label><input type="number" id="item-price"></div>
                    <div style="flex:1"><label>Spots</label><input type="number" id="item-stock"></div>
                </div>
                <label>Schedule Start (YYYY-MM-DDTHH:mm)</label><input type="datetime-local" id="item-schedule-date">
                <label>Schedule End / Auction Close</label><input type="datetime-local" id="item-schedule-end">
                <label>Form Link</label><input type="text" id="item-form">
                <button onclick="submitItem()">SAVE ITEM</button>
            </div>
            <ul id="item-list"></ul>
        </div>
    </div>

    <script>
        const API_URL = 'https://pokeballer-worker.kronborgnielsen.workers.dev/api';
        
        if(localStorage.getItem('adminToken')) {
            document.getElementById('login-section').style.display='none';
            document.getElementById('admin-section').style.display='block';
            loadItems();
        }

        async function login() {
            const u = document.getElementById('login-username').value;
            const p = document.getElementById('login-password').value;
            const res = await fetch(`${API_URL}/login`, { method:'POST', body: JSON.stringify({username:u, password:p}) });
            if(res.ok) { localStorage.setItem('adminToken','1'); location.reload(); } else alert('Fail');
        }

        async function loadItems() {
            const res = await fetch(`${API_URL}/items`);
            const items = await res.json();
            const list = document.getElementById('item-list');
            list.innerHTML = '';
            items.forEach(item => {
                list.innerHTML += `<li>
                    <div class="item-header"><span class="item-title">${item.name}</span> <span>$${item.price} ${item.priceType==='auction'?'<span class="badge b-auc">Auction</span>':''}</span></div>
                    <div class="btn-group">
                        <button style="background:#00b8ff;" onclick="deleteItem('${item.id}')">DELETE</button>
                    </div>
                </li>`;
            });
        }

        async function submitItem() {
            const body = {
                name: document.getElementById('item-name').value,
                description: document.getElementById('item-description').value,
                price: parseFloat(document.getElementById('item-price').value),
                stock: parseInt(document.getElementById('item-stock').value),
                priceType: document.getElementById('item-price-type').value,
                scheduleDate: document.getElementById('item-schedule-date').value,
                scheduleEnd: document.getElementById('item-schedule-end').value,
                googleFormLink: document.getElementById('item-form').value
            };
            await fetch(`${API_URL}/items`, { method:'POST', body: JSON.stringify(body) });
            location.reload();
        }

        async function deleteItem(id) {
            await fetch(`${API_URL}/items/${id}`, { method:'DELETE' });
            loadItems();
        }
    </script>
</body>
</html>
