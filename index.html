<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PBM Breaks - The Crystal League</title>
    
    <link rel="icon" type="image/svg+xml" href="https://upload.wikimedia.org/wikipedia/commons/5/53/Pok%C3%A9_Ball_icon.svg">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800;900&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/@phosphor-icons/web"></script>

    <style>
        :root {
            --bg-core: #080810;
            --glass-panel: rgba(20, 25, 40, 0.75);
            --border-light: rgba(255, 255, 255, 0.08);
            --accent-cyan: #00ffe7;
            --accent-purple: #bd00ff;
            --accent-gold: #ffd700;
        }

        * { margin:0; padding:0; box-sizing:border-box; }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-core);
            color: white;
            overflow-x: hidden;
            min-height: 100vh;
            position: relative;
        }

        /* --- ATMOSPHERE BACKGROUND --- */
        /* A subtle grid to give it structure */
        body::before {
            content:''; position: fixed; top:0; left:0; width:100%; height:100%;
            background-image: 
                linear-gradient(rgba(255, 255, 255, 0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(255, 255, 255, 0.03) 1px, transparent 1px);
            background-size: 50px 50px;
            z-index: -10;
            mask-image: radial-gradient(circle at center, black 40%, transparent 100%);
        }

        /* --- THE POKEMON STAGE (Fixed Composition) --- */
        .poke-layer {
            position: fixed;
            pointer-events: none;
            z-index: -5;
            transition: transform 0.1s ease-out; /* Smooth movement */
        }

        /* 1. SUICUNE (Center Watermark) */
        .p-suicune {
            top: 50%; left: 50%; transform: translate(-50%, -50%);
            width: 800px; opacity: 0.1;
            filter: grayscale(100%) drop-shadow(0 0 50px var(--accent-cyan));
        }

        /* 2. RAYQUAZA (Top Left - The Arch) */
        .p-rayquaza {
            top: -50px; left: -100px; width: 700px;
            opacity: 0.6;
            filter: drop-shadow(0 20px 60px rgba(0, 255, 100, 0.15));
            /* Subtle fade at the bottom so it blends */
            mask-image: linear-gradient(to bottom, black 70%, transparent 100%);
        }

        /* 3. CHARIZARD (Top Right - Flipped to face content) */
        .p-charizard {
            top: -40px; right: -80px; width: 600px;
            opacity: 0.5;
            transform: scaleX(-1); /* FLIP IMAGE to look inwards */
            filter: drop-shadow(0 20px 60px rgba(255, 50, 0, 0.2));
            mask-image: linear-gradient(to bottom, black 70%, transparent 100%);
        }

        /* 4. GENGAR (Mid Left - Peeking) */
        .p-gengar {
            top: 45%; left: -60px; width: 350px;
            opacity: 0.7;
            transform: rotate(10deg);
            filter: drop-shadow(0 0 50px rgba(138, 43, 226, 0.2));
        }

        /* 5. GARDEVOIR (Mid Right - Sentinel) */
        .p-gardevoir {
            top: 45%; right: -60px; width: 350px;
            opacity: 0.5;
            transform: scaleX(-1); /* FLIP IMAGE */
            filter: drop-shadow(0 0 50px rgba(100, 255, 150, 0.1));
        }

        /* 6. VAPOREON & CUBONE (Bottom Anchors) */
        .p-vaporeon {
            bottom: 0; left: -40px; width: 400px;
            opacity: 0.7;
            filter: drop-shadow(0 -10px 40px rgba(0, 238, 255, 0.2));
        }
        .p-cubone {
            bottom: -20px; right: 10%; width: 250px;
            opacity: 0.8;
            filter: drop-shadow(0 0 30px rgba(150, 100, 50, 0.2));
            z-index: -4;
        }

        /* --- LAYOUT & UI --- */
        main {
            position: relative; z-index: 2;
            max-width: 1200px; margin: 0 auto; padding: 0 2rem;
        }

        header {
            text-align: center; padding: 6rem 0 3rem;
            position: relative;
        }
        
        .brand-badge {
            display: inline-block; padding: 6px 16px; margin-bottom: 15px;
            border: 1px solid var(--accent-cyan); border-radius: 50px;
            color: var(--accent-cyan); font-size: 0.8rem; letter-spacing: 2px; font-weight: 700;
            background: rgba(0, 255, 231, 0.1); box-shadow: 0 0 20px rgba(0, 255, 231, 0.2);
        }

        h1 {
            font-size: clamp(3rem, 8vw, 5.5rem);
            font-weight: 900; letter-spacing: -2px;
            background: linear-gradient(180deg, #fff, #888);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            text-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }

        .section-divider {
            display: flex; align-items: center; gap: 20px; margin: 4rem 0 2rem;
        }
        .divider-line { flex: 1; height: 1px; background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent); }
        .divider-title {
            font-weight: 800; letter-spacing: 1px; color: var(--accent-cyan);
            text-shadow: 0 0 15px var(--accent-cyan);
        }

        /* --- GLASS CARDS (Cleaned Up) --- */
        .card-panel {
            background: var(--glass-panel);
            backdrop-filter: blur(16px); -webkit-backdrop-filter: blur(16px);
            border: 1px solid var(--border-light);
            border-radius: 16px;
            overflow: hidden;
            transition: transform 0.3s ease, box-shadow 0.3s ease, border-color 0.3s ease;
            box-shadow: 0 15px 40px rgba(0,0,0,0.4);
        }
        .card-panel:hover {
            transform: translateY(-5px);
            border-color: var(--accent-cyan);
            box-shadow: 0 20px 50px rgba(0, 238, 255, 0.15);
        }

        /* --- YOUTUBE GRID --- */
        .yt-grid {
            display: grid; grid-template-columns: 1fr; gap: 25px;
        }
        @media(min-width: 768px) { .yt-grid { grid-template-columns: 1fr 1fr; } }

        .yt-thumb-box { position: relative; aspect-ratio: 16/9; overflow: hidden; }
        .yt-thumb { width: 100%; height: 100%; object-fit: cover; transition: 0.5s; }
        .card-panel:hover .yt-thumb { transform: scale(1.05); }
        
        .status-badge {
            position: absolute; top: 15px; left: 15px;
            padding: 6px 12px; border-radius: 6px;
            font-weight: 800; font-size: 0.75rem; text-transform: uppercase;
            display: flex; align-items: center; gap: 6px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.5);
        }
        .bg-live { background: #ff0040; color: white; }
        .bg-upcoming { background: var(--accent-gold); color: black; }
        .bg-vod { background: #222; color: #aaa; border: 1px solid #444; }

        .yt-info { padding: 20px; }
        .yt-title { font-weight: 700; line-height: 1.4; font-size: 1.1rem; color: #fff; }

        /* --- STORE GRID --- */
        .store-grid {
            display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 25px;
        }
        
        .product-img-box { height: 220px; position: relative; background: radial-gradient(circle, #2a2a35, #1a1a20); }
        .product-img { width: 100%; height: 100%; object-fit: contain; padding: 20px; transition: 0.4s; }
        .card-panel:hover .product-img { transform: scale(1.1) rotate(2deg); }

        .product-info { padding: 20px; text-align: center; }
        .product-title { font-weight: 800; font-size: 1.2rem; margin-bottom: 5px; }
        .product-desc { font-size: 0.9rem; color: #aaa; margin-bottom: 15px; height: 40px; overflow: hidden; }
        
        .price-tag { 
            font-size: 1.5rem; font-weight: 900; color: var(--accent-cyan); display: block; margin-bottom: 15px;
            text-shadow: 0 0 15px rgba(0, 255, 231, 0.3);
        }

        .btn-action {
            display: block; padding: 12px; width: 100%;
            background: linear-gradient(90deg, var(--accent-cyan), var(--accent-purple));
            color: white; font-weight: 800; text-transform: uppercase; text-decoration: none;
            border-radius: 8px; transition: 0.3s;
        }
        .btn-action:hover { filter: brightness(1.2); box-shadow: 0 0 20px var(--accent-purple); }

        footer { text-align: center; padding: 6rem 0 3rem; color: #555; font-size: 0.9rem; position: relative; z-index: 2; }

        /* --- RESPONSIVE CLEANUP --- */
        @media (max-width: 1024px) {
            .p-rayquaza { left: -200px; opacity: 0.4; }
            .p-charizard { right: -150px; opacity: 0.4; }
        }
        @media (max-width: 768px) {
            /* On mobile, fade them out more so text is readable */
            .p-rayquaza, .p-charizard { top: 0; width: 300px; opacity: 0.2; }
            .p-gengar, .p-gardevoir { opacity: 0.15; top: 60%; }
            .p-vaporeon { left: -100px; opacity: 0.3; }
            h1 { font-size: 3.5rem; }
        }

    </style>
</head>
<body>

    <img src="https://assets.pokemon.com/assets/cms2/img/pokedex/full/245.png" class="poke-layer p-suicune">
    <img src="https://assets.pokemon.com/assets/cms2/img/pokedex/full/384.png" class="poke-layer p-rayquaza">
    <img src="https://assets.pokemon.com/assets/cms2/img/pokedex/full/006.png" class="poke-layer p-charizard">
    <img src="https://assets.pokemon.com/assets/cms2/img/pokedex/full/094.png" class="poke-layer p-gengar">
    <img src="https://assets.pokemon.com/assets/cms2/img/pokedex/full/282.png" class="poke-layer p-gardevoir">
    <img src="https://assets.pokemon.com/assets/cms2/img/pokedex/full/134.png" class="poke-layer p-vaporeon">
    <img src="https://assets.pokemon.com/assets/cms2/img/pokedex/full/104.png" class="poke-layer p-cubone">

    <header>
        <div class="brand-badge">THE CRYSTAL LEAGUE</div>
        <h1>PBM BREAKS</h1>
    </header>

    <main>
        <div class="section-divider">
            <span class="divider-line"></span>
            <span class="divider-title">LIVE ACTION</span>
            <span class="divider-line"></span>
        </div>

        <div class="yt-grid" id="yt-feed">
            <div style="grid-column:1/-1; text-align:center; padding:2rem; color:#666;">Scanning Feed...</div>
        </div>

        <div class="section-divider">
            <span class="divider-line"></span>
            <span class="divider-title">AVAILABLE DROPS</span>
            <span class="divider-line"></span>
        </div>

        <div class="store-grid" id="store-feed">
            <div style="grid-column:1/-1; text-align:center; padding:2rem; color:#666;">Loading Inventory...</div>
        </div>
    </main>

    <footer>
        <p>© 2025 PBM Breaks • Not affiliated with Nintendo • Crafted in the Crystal Realm</p>
    </footer>

    <script>
        const API_URL = 'https://pokeballer-worker.kronborgnielsen.workers.dev/api';

        async function loadContent() {
            const ytContainer = document.getElementById('yt-feed');
            const storeContainer = document.getElementById('store-feed');

            // 1. FETCH YOUTUBE
            try {
                const res = await fetch(`${API_URL}/youtube`);
                const text = await res.text();
                const doc = new DOMParser().parseFromString(text, "text/xml");
                const entries = Array.from(doc.querySelectorAll("entry")).slice(0, 4); // Limit to 4

                if(entries.length) ytContainer.innerHTML = '';
                
                entries.forEach(entry => {
                    const title = entry.querySelector("title").textContent;
                    const id = entry.querySelector("videoId").textContent;
                    const titleLower = title.toLowerCase();
                    
                    let badgeClass = 'bg-vod';
                    let badgeText = 'LATEST VOD';
                    
                    if(titleLower.includes('live')) { badgeClass = 'bg-live'; badgeText = 'LIVE NOW'; }
                    else if(titleLower.includes('upcoming')) { badgeClass = 'bg-upcoming'; badgeText = 'UPCOMING'; }

                    ytContainer.innerHTML += `
                        <div class="card-panel" onclick="window.open('https://youtube.com/watch?v=${id}')" style="cursor:pointer;">
                            <div class="yt-thumb-box">
                                <img src="https://i.ytimg.com/vi/${id}/maxresdefault.jpg" class="yt-thumb">
                                <div class="status-badge ${badgeClass}">${badgeText}</div>
                            </div>
                            <div class="yt-info">
                                <div class="yt-title">${title}</div>
                            </div>
                        </div>
                    `;
                });
            } catch(e) { ytContainer.innerHTML = '<div style="text-align:center">Feed Unavailable</div>'; }

            // 2. FETCH STORE
            try {
                const res = await fetch(`${API_URL}/items`);
                const items = await res.json();
                
                if(items.length) storeContainer.innerHTML = '';

                items.forEach(item => {
                    const img = item.image || 'https://assets.pokemon.com/assets/cms2/img/misc/trading-card-games/cards/tcg_default_card.png';
                    const btn = (item.stock > 0 && item.googleFormLink)
                        ? `<a href="${item.googleFormLink}" target="_blank" class="btn-action">Claim Spot</a>`
                        : `<div class="btn-action" style="background:#333; cursor:not-allowed;">Sold Out</div>`;

                    storeContainer.innerHTML += `
                        <div class="card-panel">
                            <div class="product-img-box">
                                <img src="${img}" class="product-img">
                            </div>
                            <div class="product-info">
                                <div class="product-title">${item.name}</div>
                                <div class="product-desc">${item.description}</div>
                                <div class="price-tag">$${item.price}</div>
                                ${btn}
                            </div>
                        </div>
                    `;
                });
            } catch(e) { storeContainer.innerHTML = '<div style="text-align:center">Store Unavailable</div>'; }
        }

        // Simple Parallax for Depth
        document.addEventListener('mousemove', (e) => {
            const x = (window.innerWidth - e.pageX) / 50;
            const y = (window.innerHeight - e.pageY) / 50;
            
            const layers = document.querySelectorAll('.poke-layer');
            layers.forEach(layer => {
                const speed = layer.classList.contains('p-suicune') ? 0.5 : 1.5;
                layer.style.transform = `translate(${x * speed}px, ${y * speed}px) ${layer.classList.contains('p-charizard') || layer.classList.contains('p-gardevoir') ? 'scaleX(-1)' : ''}`;
            });
        });

        loadContent();
    </script>
</body>
</html>
