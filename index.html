<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PBM Breaks - Pokémon League Store</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            /* Clean, modern 2025 Pokémon-inspired palette */
            --bg-primary: #0f0f1a;
            --bg-secondary: #161622;
            --surface: #1e1e2e;
            --accent: #00d4ff;
            --accent-muted: #00a3cc;
            --text-primary: #ffffff;
            --text-secondary: #b0b0d0;
            --text-muted: #8888aa;
            --success: #00ff9d;
            --warning: #ffcc00;
            --danger: #ff4d4d;
        }

        * { box-sizing: border-box; }

        body {
            margin: 0;
            font-family: 'Inter', system-ui, -apple-system, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            background-image: 
                radial-gradient(circle at 20% 80%, rgba(0, 212, 255, 0.12) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(0, 212, 255, 0.08) 0%, transparent 50%);
            position: relative;
            overflow-x: hidden;
        }

        /* Subtle animated background glow */
        body::before {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(135deg, rgba(0, 212, 255, 0.04), transparent 50%);
            animation: bgPulse 20s infinite alternate;
            pointer-events: none;
            z-index: -1;
        }

        @keyframes bgPulse {
            0% { opacity: 0.6; }
            100% { opacity: 1; }
        }

        header {
            text-align: center;
            padding: 3rem 1rem 2rem;
            background: linear-gradient(to bottom, rgba(15,15,26,0.95), transparent);
            backdrop-filter: blur(12px);
            position: relative;
            z-index: 10;
        }

        .header-logo {
            width: 140px;
            filter: drop-shadow(0 0 30px rgba(0,212,255,0.4));
            transition: transform 0.4s ease;
        }

        .header-logo:hover {
            transform: scale(1.08);
        }

        h1 {
            margin: 1rem 0 0;
            font-size: 3.5rem;
            font-weight: 800;
            letter-spacing: -1px;
            background: linear-gradient(90deg, #00d4ff, #ffffff);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 4px 20px rgba(0,212,255,0.3);
        }

        main {
            flex: 1;
            padding: 2rem 1rem 4rem;
            max-width: 1400px;
            margin: 0 auto;
            width: 100%;
        }

        .store-intro {
            text-align: center;
            max-width: 900px;
            margin: 0 auto 5rem;
            padding: 3rem 2rem;
            background: var(--surface);
            border-radius: 24px;
            border: 1px solid rgba(0,212,255,0.2);
            box-shadow: 0 20px 60px rgba(0,0,0,0.4);
        }

        .store-intro h2 {
            font-size: 2.6rem;
            font-weight: 700;
            margin: 0 0 1rem;
            background: linear-gradient(90deg, #00ff9d, #00d4ff);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .store-intro p {
            font-size: 1.2rem;
            color: var(--text-secondary);
            max-width: 700px;
            margin: 0 auto;
        }

        .store-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(340px, 1fr));
            gap: 2rem;
        }

        .item-card {
            background: var(--surface);
            border-radius: 20px;
            overflow: hidden;
            border: 1px solid rgba(0,212,255,0.15);
            transition: all 0.35s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
        }

        .item-card::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; height: 4px;
            background: linear-gradient(90deg, var(--accent), #00ff9d);
            transform: scaleX(0);
            transform-origin: left;
            transition: transform 0.4s ease;
        }

        .item-card:hover {
            transform: translateY(-12px);
            box-shadow: 0 25px 60px rgba(0,0,0,0.5), 0 0 40px rgba(0,212,255,0.2);
            border-color: var(--accent);
        }

        .item-card:hover::before {
            transform: scaleX(1);
        }

        .item-image {
            width: 100%;
            height: 260px;
            object-fit: cover;
            transition: transform 0.4s ease;
        }

        .item-card:hover .item-image {
            transform: scale(1.05);
        }

        .card-content {
            padding: 1.8rem;
        }

        .item-card h3 {
            font-size: 1.5rem;
            font-weight: 700;
            margin: 0 0 0.8rem;
            color: var(--text-primary);
        }

        .description {
            color: var(--text-secondary);
            font-size: 0.98rem;
            margin-bottom: 1.5rem;
            line-height: 1.6;
        }

        .item-details {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .item-price {
            font-size: 2rem;
            font-weight: 800;
            color: var(--accent);
        }

        .item-stock {
            background: rgba(0,212,255,0.15);
            color: var(--accent);
            padding: 0.5rem 1rem;
            border-radius: 50px;
            font-size: 0.9rem;
            font-weight: 600;
            border: 1px solid rgba(0,212,255,0.3);
        }

        .action-button {
            width: 100%;
            padding: 1rem;
            background: linear-gradient(135deg, var(--accent), #00a3cc);
            color: white;
            border: none;
            border-radius: 14px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            text-align: center;
            box-shadow: 0 8px 25px rgba(0,212,255,0.3);
        }

        .action-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 35px rgba(0,212,255,0.4);
            background: linear-gradient(135deg, #00e6ff, #00b8e6);
        }

        .out-of-stock {
            width: 100%;
            padding: 1rem;
            background: rgba(255,77,77,0.15);
            color: var(--danger);
            border: 1px solid rgba(255,77,77,0.3);
            border-radius: 14px;
            text-align: center;
            font-weight: 600;
        }

        footer {
            text-align: center;
            padding: 3rem 1rem;
            color: var(--text-muted);
            font-size: 0.95rem;
            background: var(--bg-secondary);
            border-top: 1px solid rgba(0,212,255,0.1);
        }

        /* Lightbox - modern style */
        #lightbox-overlay {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(10,10,20,0.97);
            backdrop-filter: blur(12px);
            justify-content: center;
            align-items: center;
            z-index: 1000;
            cursor: zoom-out;
        }

        #lightbox-overlay.show {
            display: flex;
        }

        #lightbox-image {
            max-width: 92vw;
            max-height: 92vh;
            object-fit: contain;
            border-radius: 20px;
            box-shadow: 0 20px 80px rgba(0,0,0,0.8);
            border: 3px solid var(--accent);
        }

        /* Responsive */
        @media (max-width: 768px) {
            h1 { font-size: 2.8rem; }
            .store-intro h2 { font-size: 2.2rem; }
            .store-container { grid-template-columns: 1fr; }
            .item-card { margin: 0 auto; max-width: 380px; }
        }

        @media (max-width: 480px) {
            h1 { font-size: 2.3rem; }
            .header-logo { width: 110px; }
            .store-intro { padding: 2rem 1.5rem; margin-bottom: 3rem; }
        }
    </style>
</head>
<body>

    <header>
        <img src="https://assets.pokemon.com/assets/cms2/img/pokedex/full/245.png" alt="Suicune Logo" class="header-logo">
        <h1>PBM BREAKS</h1>
    </header>

    <main>
        <div class="store-intro">
            <h2>Welcome to PBM Breaks!</h2>
            <p>Get ready for live TCG pack openings and curated breaks with Pokeballer Mike! We're live on YouTube, offering exclusive bundles and the thrill of the hunt. Grab your spot and let's pull some rare cards!</p>
        </div>

        <div id="store-content" class="store-container">
            <div class="loading-spinner" id="loading-spinner"></div>
        </div>
    </main>

    <footer>
        <p>© 2025 PBM Breaks. All Rights Reserved. Not affiliated with Nintendo or The Pokémon Company.</p>
    </footer>

    <div id="lightbox-overlay">
        <img id="lightbox-image" src="" alt="Expanded view">
    </div>

    <script>
        const API_URL = 'https://pokeballer-worker.kronborgnielsen.workers.dev/api';
        const MAX_RETRIES = 3;
        const RETRY_DELAY = 1000;

        async function loadItems() {
            const spinner = document.getElementById('loading-spinner');
            spinner.classList.add('show');

            for (let attempt = 1; attempt <= MAX_RETRIES; attempt++) {
                try {
                    const response = await fetch(`${API_URL}/items`);
                    if (!response.ok) throw new Error(`Status: ${response.status}`);

                    const items = await response.json();
                    const storeContent = document.getElementById('store-content');
                    storeContent.innerHTML = '';

                    if (items.length === 0) {
                        storeContent.innerHTML = '<p style="text-align:center; color:var(--text-muted); grid-column:1/-1; font-size:1.3rem;">No new breaks scheduled at the moment, Trainer. Check back soon!</p>';
                        spinner.classList.remove('show');
                        return;
                    }

                    items.forEach((item, index) => {
                        const itemDiv = document.createElement('div');
                        itemDiv.className = 'item-card';
                        itemDiv.style.animationDelay = `${index * 0.1}s`;

                        const defaultImage = "https://assets.pokemon.com/assets/cms2/img/misc/trading-card-games/cards/tcg_default_card.png";
                        const imgSrc = item.image || defaultImage;

                        const actionHtml = item.stock > 0 && item.googleFormLink
                            ? `<a href="${item.googleFormLink}" target="_blank" class="action-button">Join Break!</a>`
                            : `<div class="out-of-stock">Break Full!</div>`;

                        itemDiv.innerHTML = `
                            <img src="${imgSrc}" alt="${item.name}" class="item-image">
                            <div class="card-content">
                                <h3>${item.name}</h3>
                                <p class="description">${item.description}</p>
                                <div class="item-details">
                                    <span class="item-price">$${item.price.toFixed(2)}</span>
                                    <span class="item-stock">Stock: ${item.stock}</span>
                                </div>
                                ${actionHtml}
                            </div>
                        `;
                        storeContent.appendChild(itemDiv);
                    });

                    spinner.classList.remove('show');
                    return;
                } catch (error) {
                    if (attempt === MAX_RETRIES) {
                        document.getElementById('store-content').innerHTML = '<p style="color:var(--danger); text-align:center; grid-column:1/-1;">Failed to load breaks. Please refresh or try again later.</p>';
                    }
                    await new Promise(r => setTimeout(r, RETRY_DELAY));
                }
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            loadItems();

            // Lightbox functionality
            const overlay = document.getElementById('lightbox-overlay');
            const lbImg = document.getElementById('lightbox-image');
            document.getElementById('store-content').addEventListener('click', e => {
                if (e.target.classList.contains('item-image')) {
                    lbImg.src = e.target.src;
                    lbImg.alt = e.target.alt;
                    overlay.classList.add('show');
                }
            });

            overlay.addEventListener('click', () => {
                overlay.classList.remove('show');
                lbImg.src = '';
            });
        });
    </script>
</body>
</html>
