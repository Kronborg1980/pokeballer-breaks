<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PBM Breaks - PokÃ©mon League Store</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #0a0a15;
            --surface: #12121f;
            --card: #1a1a2e;
            --accent: #00eeff;
            --electric: #00ff9d;
            --purple: #9d4edd;
            --text: #ffffff;
            --text2: #e0e0ff;
        }

        * { margin:0; padding:0; box-sizing:border-box; }

        html, body {
            height: 100%;
            font-family: 'Inter', sans-serif;
            background: var(--bg);
            color: var(--text);
            overflow-x: hidden;
        }

        body {
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            background-image: 
                radial-gradient(circle at 10% 20%, rgba(0,238,255,0.1) 0%, transparent 50%),
                radial-gradient(circle at 90% 80%, rgba(157,78,221,0.1) 0%, transparent 50%);
        }

        /* Only light orbs - no heavy blur on Edge */
        .orb {
            position: absolute;
            border-radius: 50%;
            background: radial-gradient(circle, var(--accent), transparent);
            opacity: 0.2;
            pointer-events: none;
            filter: blur(40px);
        }
        .orb:nth-child(1){width:600px;height:600px;top:-10%;left:-10%;}
        .orb:nth-child(2){width:800px;height:800px;bottom:-20%;right:-15%;}
        .orb:nth-child(3){width:500px;height:500px;top:25%;right:10%;}

        header {
            text-align: center;
            padding: 3.5rem 1rem 4.5rem;
            position: relative;
        }
        .header-glow {
            position: absolute;
            inset: 0;
            background: conic-gradient(from 90deg at 50% 20%, #00eeff, #9d4edd, #00ff9d, #00eeff);
            opacity: 0.5;
            animation: rotate 30s infinite linear;
        }
        @keyframes rotate { to { transform: rotate(360deg); } }
        .header-logo { width: 170px; filter: drop-shadow(0 0 30px var(--accent)); animation: levitate 6s infinite ease-in-out; }
        @keyframes levitate { 0%,100% { transform: translateY(0); } 50% { transform: translateY(-15px); } }

        h1 {
            font-size: 5.5rem;
            font-weight: 900;
            letter-spacing: -3px;
            background: linear-gradient(90deg, #00eeff, #ffffff, #ff00ff);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-top: 1rem;
        }

        main {
            flex: 1;
            max-width: 1600px;
            margin: 0 auto;
            padding: 0 1rem 4rem;
            position: relative;
            z-index: 2;
        }

        .store-intro {
            text-align: center;
            padding: 4rem 2rem;
            margin-bottom: 4rem;
            background: linear-gradient(135deg, rgba(26,26,46,0.9), rgba(18,18,31,0.95));
            border-radius: 36px;
            border: 2px solid rgba(0,238,255,0.4);
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
            backdrop-filter: blur(12px);
        }
        .store-intro h2 { font-size: 4rem; font-weight: 900; background: linear-gradient(120deg, var(--electric), var(--accent), var(--purple)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .store-intro p { font-size: 1.35rem; color: var(--text2); max-width: 850px; margin: 1.2rem auto 0; line-height: 1.8; }

        /* YOUTUBE - FAST THUMBNAILS */
        .youtube-section { margin: 5rem 0; }
        .youtube-title {
            font-size: 4.8rem;
            font-weight: 900;
            text-align: center;
            margin-bottom: 3rem;
            background: linear-gradient(90deg, #ff0080, #00eeff, #00ff9d);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .youtube-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(360px, 1fr));
            gap: 2.5rem;
            padding: 1.5rem;
            background: rgba(18,18,31,0.5);
            border-radius: 36px;
            border: 1px solid rgba(0,238,255,0.25);
        }
        .yt-video {
            position: relative;
            border-radius: 28px;
            overflow: hidden;
            background: var(--card);
            border: 2px solid transparent;
            transition: all 0.35s ease;
            box-shadow: 0 15px 40px rgba(0,0,0,0.4);
            cursor: pointer;
        }
        .yt-video:hover { transform: translateY(-18px) scale(1.04); border-color: var(--accent); box-shadow: 0 30px 70px rgba(0,238,255,0.35); }
        .yt-thumb { width: 100%; height: 220px; object-fit: cover; display: block; }
        .play-button {
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            width: 70px; height: 70px;
            background: rgba(0,0,0,0.7);
            border: 4px solid white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
            color: white;
            transition: all 0.3s;
        }
        .yt-video:hover .play-button { transform: translate(-50%, -50%) scale(1.2); background: var(--accent); }
        .yt-overlay { position: absolute; bottom: 0; left: 0; right: 0; padding: 1.8rem 1.4rem 1.4rem; background: linear-gradient(to top, rgba(10,10,21,0.95), transparent); }
        .yt-title { font-size: 1.2rem; font-weight: 800; color: var(--text); line-height: 1.4; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
        .upcoming-badge { position: absolute; top: 16px; left: 16px; background: linear-gradient(135deg, #ff006e, #ff8c00); color: white; padding: 0.5rem 1.2rem; border-radius: 50px; font-weight: 900; font-size: 0.9rem; box-shadow: 0 0 25px rgba(255,0,110,0.7); animation: badgePulse 2s infinite; }
        .live-now { background: linear-gradient(90deg, #ff0000, #ff0066) !important; animation: livePulse 1.5s infinite !important; }
        @keyframes badgePulse { 0%,100% { transform: scale(1); } 50% { transform: scale(1.1); } }
        @keyframes livePulse { 0%,100% { box-shadow: 0 0 25px #ff0000; } 50% { box-shadow: 0 0 55px #ff0000; } }

        .store-container { display: grid; grid-template-columns: repeat(auto-fill, minmax(360px, 1fr)); gap: 2.8rem; margin-top: 4rem; }
        .item-card { background: var(--card); border-radius: 30px; overflow: hidden; border: 1px solid rgba(0,238,255,0.2); transition: all 0.4s ease; box-shadow: 0 18px 45px rgba(0,0,0,0.5); display: flex; flex-direction: column; }
        .item-card:hover { transform: translateY(-18px) scale(1.03); border-color: var(--accent); box-shadow: 0 35px 90px rgba(0,238,255,0.35); }
        .item-image { width: 100%; height: 290px; object-fit: cover; transition: transform 0.6s ease; loading: lazy; }
        .item-card:hover .item-image { transform: scale(1.12); }
        .card-content { padding: 2rem; background: linear-gradient(to top, var(--surface), transparent); flex-grow: 1; display: flex; flex-direction: column; }
        .item-card h3 { font-size: 1.9rem; font-weight: 800; background: linear-gradient(90deg, var(--accent), #fff); -webkit-background-clip: text; -webkit-text-fill-color: transparent; margin-bottom: 0.9rem; }
        .description { color: var(--text2); margin-bottom: 1.4rem; line-height: 1.7; flex-grow: 1; }
        .item-details { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.6rem; padding-top: 0.9rem; border-top: 1px solid rgba(0,238,255,0.2); }
        .item-price { font-size: 2.5rem; font-weight: 900; color: var(--electric); text-shadow: 0 0 25px rgba(0,255,157,0.5); }
        .item-stock { background: rgba(0,238,255,0.2); color: var(--accent); padding: 0.6rem 1.2rem; border-radius: 50px; font-weight: 700; border: 1px solid var(--accent); }
        .action-button, .out-of-stock { width: 100%; padding: 1.3rem; text-align: center; border-radius: 22px; font-size: 1.35rem; font-weight: 800; margin-top: auto; }
        .action-button { background: linear-gradient(135deg, var(--accent), var(--purple)); color: white; text-decoration: none; box-shadow: 0 12px 35px rgba(0,238,255,0.4); transition: all 0.3s; }
        .action-button:hover { transform: translateY(-5px); box-shadow: 0 22px 55px rgba(0,238,255,0.6); background: linear-gradient(135deg, #00ffff, #d946ef); }
        .out-of-stock { background: rgba(255,77,77,0.25); color: #ff6b6b; border: 2px solid #ff4444; }

        /* FIXED FOOTER - NO MORE BLANK SPACE */
        footer {
            margin-top: auto;
            padding: 2rem 1rem;
            text-align: center;
            color: #666;
            background: rgba(10,10,21,0.98);
            border-top: 1px solid rgba(0,238,255,0.15);
            font-size: 0.9rem;
        }
        footer p:last-child { font-size: 0.78rem; color: #555; margin-top: 0.4rem; }

        #lightbox-overlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.97); backdrop-filter: blur(20px); justify-content: center; align-items: center; z-index: 1000; cursor: zoom-out; }
        #lightbox-overlay.show { display: flex; }
        #lightbox-image { max-width: 96vw; max-height: 96vh; border-radius: 30px; border: 5px solid var(--accent); box-shadow: 0 0 100px rgba(0,238,255,0.7); }

        @media (max-width: 768px) {
            h1, .youtube-title { font-size: 3.8rem; }
            .youtube-grid, .store-container { grid-template-columns: 1fr; gap: 2rem; padding: 1rem; }
            .yt-thumb { height: 200px; }
        }
    </style>
</head>
<body>

    <div class="orb"></div><div class="orb"></div><div class="orb"></div>

    <header>
        <div class="header-glow"></div>
        <img src="https://assets.pokemon.com/assets/cms2/img/pokedex/full/245.png" alt="Suicune" class="header-logo" loading="lazy">
        <h1>PBM BREAKS</h1>
    </header>

    <main>
        <div class="store-intro">
            <h2>Welcome to PBM Breaks!</h2>
            <p>Get ready for live TCG pack openings and curated breaks with Pokeballer Mike! We're live on YouTube, offering exclusive bundles and the thrill of the hunt. Grab your spot and let's pull some rare cards!</p>
        </div>

        <section class="youtube-section">
            <h2 class="youtube-title">LIVE BREAKS ON YOUTUBE</h2>
            <div class="youtube-grid" id="youtube-videos"></div>
        </section>

        <div id="store-content" class="store-container"></div>
    </main>

    <!-- Footer now perfectly hugs the bottom -->
    <footer>
        <p>Â© 2025 PBM Breaks. All Rights Reserved.</p>
        <p>Not affiliated with Nintendo or The PokÃ©mon Company</p>
    </footer>

    <div id="lightbox-overlay"><img id="lightbox-image" src="" alt=""></div>

    <script>
        const API_URL = 'https://pokeballer-worker.kronborgnielsen.workers.dev/api';
        const CHANNEL_ID = "UCdFYy9uChCNAWbvVhTYwHaQ";

        async function loadItems() {
            const container = document.getElementById('store-content');
            container.innerHTML = '<div style="grid-column:1/-1;text-align:center;padding:5rem;color:var(--accent);font-size:2.2rem;">Loading Breaks...</div>';
            try {
                const res = await fetch(`${API_URL}/items`);
                const items = await res.json();
                container.innerHTML = '';
                if (!items.length) { container.innerHTML = '<p style="grid-column:1/-1;text-align:center;color:#aaa;font-size:1.7rem;">No active breaks â€” next one soon!</p>'; return; }
                items.forEach((item, i) => {
                    const card = document.createElement('div');
                    card.className = 'item-card';
                    const img = item.image || 'https://assets.pokemon.com/assets/cms2/img/misc/trading-card-games/cards/tcg_default_card.png';
                    const btn = item.stock > 0 && item.googleFormLink ? `<a href="${item.googleFormLink}" target="_blank" class="action-button">JOIN BREAK!</a>` : `<div class="out-of-stock">SOLD OUT</div>`;
                    card.innerHTML = `<img src="${img}" alt="${item.name}" class="item-image" loading="lazy"><div class="card-content"><h3>${item.name}</h3><p class="description">${item.description}</p><div class="item-details"><span class="item-price">$${item.price.toFixed(2)}</span><span class="item-stock">Spots: ${item.stock}</span></div>${btn}</div>`;
                    container.appendChild(card);
                });
            } catch { container.innerHTML = '<p style="grid-column:1/-1;color:#ff4444;text-align:center;">Failed to load â€” refresh!</p>'; }
        }

        async function loadYouTubeVideos() {
            const container = document.getElementById('youtube-videos');
            container.innerHTML = '<div style="grid-column:1/-1;padding:5rem;color:var(--accent);font-size:1.8rem;">Loading latest videos...</div>';

            const proxies = ['https://api.allorigins.ml/raw?url=', 'https://corsproxy.io/?', 'https://thingproxy.freeboard.io/fetch/'];
            let success = false;

            for (let proxy of proxies) {
                try {
                    const url = `${proxy}${encodeURIComponent('https://www.youtube.com/feeds/videos.xml?channel_id=' + CHANNEL_ID)}`;
                    const xmlText = await (await fetch(url)).text();
                    const xml = new DOMParser().parseFromString(xmlText, "application/xml");
                    if (xml.querySelector("parsererror")) continue;

                    const entries = Array.from(xml.querySelectorAll("entry")).slice(0, 6);
                    container.innerHTML = '';
                    let count = 0;

                    for (let entry of entries) {
                        if (count >= 3) break;
                        const videoId = entry.querySelector("yt\\:videoId, videoId")?.textContent;
                        if (!videoId) continue;
                        const title = entry.querySelector("title")?.textContent || "Untitled";
                        const isLive = title.toLowerCase().includes("live") || title.includes("ðŸ”´");
                        const isUpcoming = title.toLowerCase().includes("premiere") || title.toLowerCase().includes("scheduled");

                        const thumb = `https://i.ytimg.com/vi/${videoId}/maxresdefault.jpg`;

                        const card = document.createElement('div');
                        card.className = 'yt-video';
                        card.onclick = () => window.open(`https://www.youtube.com/watch?v=${videoId}`, '_blank');
                        card.innerHTML = `
                            <img src="${thumb}" alt="${title}" class="yt-thumb" loading="lazy">
                            <div class="play-button">â–¶</div>
                            ${(isLive || isUpcoming) ? `<div class="upcoming-badge ${isLive?'live-now':''}">${isLive?'LIVE NOW':'UPCOMING'}</div>` : ''}
                            <div class="yt-overlay"><div class="yt-title">${title}</div></div>
                        `;
                        container.appendChild(card);
                        count++;
                    }
                    if (count > 0) { success = true; break; }
                } catch (e) {}
            }

            if (!success) {
                container.innerHTML = `<div style="grid-column:1/-1;padding:4rem;text-align:center;"><a href="https://www.youtube.com/@pokeballermike" target="_blank" style="color:var(--accent);font-size:1.6rem;font-weight:800;text-decoration:underline;">Watch @pokeballermike â†’</a></div>`;
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            loadItems();
            loadYouTubeVideos();

            const overlay = document.getElementById('lightbox-overlay');
            const img = document.getElementById('lightbox-image');
            document.getElementById('store-content').addEventListener('click', e => {
                if (e.target.classList.contains('item-image')) { img.src = e.target.src; overlay.classList.add('show'); }
            });
            overlay.addEventListener('click', () => { overlay.classList.remove('show'); setTimeout(() => img.src = '', 300); });
        });
    </script>
</body>
</html>
