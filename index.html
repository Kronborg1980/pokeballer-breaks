<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PBM Breaks - Pokémon League Store</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #0a0a15;
            --surface: #12121f;
            --card: #1a1a2e;
            --accent: #00eeff;
            --electric: #00ff9d;
            --purple: #9d4edd;
            --text: #ffffff;
            --text2: #e0e0ff;
        }

        * { margin:0; padding:0; box-sizing:border-box; }

        html, body {
            height: auto;
            min-height: 100vh;
            font-family: 'Inter', sans-serif;
            background: var(--bg);
            color: var(--text);
            overflow-x: hidden;
            width: 100%;
            max-width: 100vw;
        }

        body {
            display: flex;
            flex-direction: column;
            background-image: 
                radial-gradient(circle at 20% 30%, rgba(0,238,255,0.14) 0%, transparent 50%),
                radial-gradient(circle at 80% 70%, rgba(157,78,221,0.12) 0%, transparent 50%),
                radial-gradient(circle at 50% 50%, rgba(0,255,157,0.07) 0%, transparent 70%);
        }

        .orb {
            position: absolute;
            border-radius: 50%;
            background: radial-gradient(circle, var(--accent), transparent);
            opacity: 0.2;
            pointer-events: none;
            filter: blur(35px);
        }
        .orb:nth-child(1){width:700px;height:700px;top:-15%;left:-10%;}
        .orb:nth-child(2){width:900px;height:900px;bottom:-25%;right:-20%;}
        .orb:nth-child(3){width:600px;height:600px;top:20%;right:5%;}

        .suicune-hero {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: clamp(300px, 85vw, 900px);
            opacity: 0.26;
            filter: drop-shadow(0 0 80px var(--accent)) brightness(1.3);
            pointer-events: none;
            z-index: 1;
            animation: suicuneFloat 22s infinite ease-in-out;
        }
        @keyframes suicuneFloat {
            0%,100% { transform: translate(-50%, -50%) translateY(0); }
            50% { transform: translate(-50%, -50%) translateY(-30px); }
        }

        header {
            position: relative;
            text-align: center;
            padding: clamp(3rem, 10vw, 7rem) 1rem clamp(4rem, 10vw, 8rem);
            z-index: 2;
        }

        .header-logo {
            width: clamp(120px, 35vw, 220px);
            filter: drop-shadow(0 0 60px var(--accent));
            animation: levitate 7s infinite ease-in-out;
        }
        @keyframes levitate { 0%,100% { transform: translateY(0); } 50% { transform: translateY(-25px); } }

        h1 {
            font-size: clamp(2.8rem, 11vw, 7.5rem);
            font-weight: 900;
            letter-spacing: -0.05em;
            background: linear-gradient(90deg, #00eeff, #ffffff, #ff00ff);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 0 100px rgba(0,238,255,0.8);
            margin-top: 1.5rem;
        }

        main {
            flex: 1;
            width: 100%;
            max-width: 100vw;
            margin: 0 auto;
            padding: 0 clamp(1rem, 4vw, 1.5rem);
            position: relative;
            z-index: 2;
        }

        .store-intro {
            text-align: center;
            padding: clamp(3rem, 8vw, 5.5rem) clamp(2rem, 5vw, 3rem);
            margin-bottom: clamp(4rem, 8vw, 6rem);
            background: linear-gradient(135deg, rgba(26,26,46,0.94), rgba(18,18,31,0.99));
            border-radius: clamp(32px, 8vw, 48px);
            border: 3px solid rgba(0,238,255,0.5);
            box-shadow: 0 35px 120px rgba(0,0,0,0.8);
            backdrop-filter: blur(18px);
        }
        .store-intro h2 {
            font-size: clamp(2.5rem, 8vw, 4.8rem);
            font-weight: 900;
            background: linear-gradient(120deg, var(--electric), var(--accent), var(--purple));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 1.2rem;
        }
        .store-intro p {
            font-size: clamp(1.1rem, 3.2vw, 1.5rem);
            color: var(--text2);
            max-width: 950px;
            margin: 0 auto;
            line-height: 2;
        }

        .youtube-section { margin: clamp(5rem, 10vw, 8rem) 0; }
        .youtube-title {
            font-size: clamp(2.8rem, 9vw, 5.5rem);
            font-weight: 900;
            text-align: center;
            margin-bottom: clamp(2.5rem, 6vw, 4.5rem);
            background: linear-gradient(90deg, #ff0080, #00eeff, #00ff9d, #ff00ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 0 80px rgba(0,238,255,0.9);
        }
        .youtube-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: clamp(2rem, 5vw, 3.2rem);
            padding: clamp(1.5rem, 4vw, 2.5rem);
            background: rgba(18,18,31,0.65);
            border-radius: clamp(32px, 8vw, 48px);
            border: 2px solid rgba(0,238,255,0.35);
            box-shadow: 0 30px 100px rgba(0,0,0,0.7);
        }
        @media (min-width: 768px) {
            .youtube-grid { grid-template-columns: repeat(auto-fit, minmax(380px, 1fr)); }
        }

        .yt-video {
            position: relative;
            border-radius: clamp(28px, 7vw, 36px);
            overflow: hidden;
            background: var(--card);
            border: 2.5px solid transparent;
            transition: all 0.5s ease;
            box-shadow: 0 25px 60px rgba(0,0,0,0.6);
            cursor: pointer;
        }
        .yt-video:hover { transform: translateY(-28px) scale(1.06); border-color: var(--accent); box-shadow: 0 50px 120px rgba(0,238,255,0.5); }
        .yt-thumb { width: 100%; height: clamp(180px, 50vw, 250px); object-fit: cover; display: block; }
        .play-button {
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            width: clamp(60px, 18vw, 90px);
            height: clamp(60px, 18vw, 90px);
            background: rgba(0,0,0,0.8);
            border: 6px solid white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: clamp(28px, 9vw, 42px);
            color: white;
            transition: all 0.35s;
        }
        .yt-video:hover .play-button { transform: translate(-50%, -50%) scale(1.3); background: var(--accent); }
        .yt-overlay { position: absolute; bottom: 0; left: 0; right: 0; padding: clamp(1.5rem, 4vw, 2.2rem); background: linear-gradient(to top, rgba(10,10,21,0.97), transparent); }
        .yt-title { font-size: clamp(1.1rem, 3.5vw, 1.35rem); font-weight: 800; color: var(--text); line-height: 1.5; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
        .upcoming-badge {
            position: absolute; top: clamp(16px, 4vw, 22px); left: clamp(16px, 4vw, 22px);
            background: linear-gradient(135deg, #ff006e, #ff8c00);
            color: white; padding: clamp(0.5rem, 1.5vw, 0.7rem) clamp(1rem, 3vw, 1.6rem);
            border-radius: 50px; font-weight: 900; font-size: clamp(0.85rem, 2.5vw, 1rem);
            box-shadow: 0 0 50px rgba(255,0,110,0.9);
            animation: badgePulse 2s infinite;
        }
        .live-now {
            background: linear-gradient(90deg, #ff0000, #ff0066) !important;
            animation: livePulse 1.5s infinite !important;
        }
        @keyframes badgePulse { 0%,100% { transform: scale(1); } 50% { transform: scale(1.12); } }
        @keyframes livePulse { 0%,100% { box-shadow: 0 0 35px #ff0000; } 50% { box-shadow: 0 0 80px #ff0000; } }

        .store-container {
            display: grid;
            grid-template-columns: 1fr;
            gap: clamp(2.5rem, 6vw, 3.2rem);
            margin-top: clamp(4rem, 8vw, 5rem);
        }
        @media (min-width: 768px) {
            .store-container { grid-template-columns: repeat(auto-fit, minmax(380px, 1fr)); }
        }

        .item-card { background: var(--card); border-radius: clamp(30px, 8vw, 38px); overflow: hidden; border: 2px solid rgba(0,238,255,0.3); transition: all 0.5s ease; box-shadow: 0 25px 65px rgba(0,0,0,0.6); display: flex; flex-direction: column; }
        .item-card:hover { transform: translateY(-25px) scale(1.05); border-color: var(--accent); box-shadow: 0 50px 130px rgba(0,238,255,0.45); }
        .item-image { width: 100%; height: clamp(240px, 60vw, 310px); object-fit: cover; transition: transform 0.7s ease; }
        .item-card:hover .item-image { transform: scale(1.16); }
        .card-content { padding: clamp(1.8rem, 5vw, 2.5rem); background: linear-gradient(to top, var(--surface), transparent); flex-grow: 1; display: flex; flex-direction: column; }
        .item-card h3 { font-size: clamp(1.7rem, 5vw, 2.2rem); font-weight: 800; background: linear-gradient(90deg, var(--accent), #fff); -webkit-background-clip: text; -webkit-text-fill-color: transparent; margin-bottom: 1rem; }
        .description { color: var(--text2); margin-bottom: 1.6rem; line-height: 1.9; flex-grow: 1; font-size: clamp(1rem, 2.8vw, 1.1rem); }
        .item-details { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.8rem; padding-top: 1rem; border-top: 1.5px solid rgba(0,238,255,0.3); }
        .item-price { font-size: clamp(2.1rem, 7vw, 2.9rem); font-weight: 900; color: var(--electric); text-shadow: 0 0 40px rgba(0,255,157,0.7); }
        .item-stock { background: rgba(0,238,255,0.25); color: var(--accent); padding: clamp(0.6rem, 1.5vw, 0.8rem) clamp(1rem, 2.5vw, 1.4rem); border-radius: 50px; font-weight: 700; border: 2px solid var(--accent); font-size: clamp(0.9rem, 2.2vw, 1rem); }
        .action-button, .out-of-stock { 
            width: 100%; 
            padding: clamp(1.2rem, 4vw, 1.6rem); 
            text-align: center; 
            border-radius: 28px; 
            font-size: clamp(1.2rem, 4vw, 1.5rem); 
            font-weight: 800; 
            margin-top: auto;
            color: white !important;
            text-shadow: 0 2px 10px rgba(0,0,0,0.8);
            letter-spacing: 1px;
        }
        .action-button { background: linear-gradient(135deg, var(--accent), var(--purple)); box-shadow: 0 18px 50px rgba(0,238,255,0.55); transition: all 0.4s; }
        .action-button:hover { transform: translateY(-8px); box-shadow: 0 32px 120px rgba(0,238,255,0.75); background: linear-gradient(135deg, #00ffff, #d946ef); }
        .out-of-stock { background: rgba(255,77,77,0.3); color: #ff6b6b !important; border: 3px solid #ff4444; }

        footer {
            padding: clamp(3rem, 8vw, 4rem) 1rem 2rem;
            text-align: center;
            color: #777;
            background: rgba(10,10,21,0.99);
            border-top: 1.5px solid rgba(0,238,255,0.25);
            font-size: clamp(0.9rem, 2.5vw, 0.95rem);
            width: 100%;
        }
        footer p:last-child { font-size: 0.82rem; color: #555; margin-top: 0.5rem; }

        #lightbox-overlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.98); backdrop-filter: blur(30px); justify-content: center; align-items: center; z-index: 1000; cursor: zoom-out; }
        #lightbox-overlay.show { display: flex; }
        #lightbox-image { max-width: 96vw; max-height: 96vh; border-radius: 38px; border: 7px solid var(--accent); box-shadow: 0 0 150px rgba(0,238,255,0.9); }
    </style>
</head>
<body>

    <div class="orb"></div><div class="orb"></div><div class="orb"></div>

    <img src="https://assets.pokemon.com/assets/cms2/img/pokedex/full/245.png" alt="Suicune" class="suicune-hero" loading="lazy">

    <header>
        <img src="https://assets.pokemon.com/assets/cms2/img/pokedex/full/245.png" alt="Suicune Logo" class="header-logo" loading="lazy">
        <h1>PBM BREAKS</h1>
    </header>

    <main>
        <div class="store-intro">
            <h2>Welcome to PBM Breaks!</h2>
            <p>Get ready for live TCG pack openings and curated breaks with Pokeballer Mike! We're live on YouTube, offering exclusive bundles and the thrill of the hunt. Grab your spot and let's pull some rare cards!</p>
        </div>

        <section class="youtube-section">
            <h2 class="youtube-title">LIVE BREAKS ON YOUTUBE</h2>
            <div class="youtube-grid" id="youtube-videos"></div>
        </section>

        <div id="store-content" class="store-container"></div>
    </main>

    <footer>
        <p>© 2025 PBM Breaks. All Rights Reserved.</p>
        <p>Not affiliated with Nintendo or The Pokémon Company</p>
    </footer>

    <div id="lightbox-overlay"><img id="lightbox-image" src="" alt=""></div>

    <script>
        const API_URL = 'https://pokeballer-worker.kronborgnielsen.workers.dev/api';
        const CHANNEL_ID = "UCdFYy9uChCNAWbvVhTYwHaQ";

        async function loadItems() {
            const container = document.getElementById('store-content');
            container.innerHTML = '<div style="text-align:center;padding:5rem;color:var(--accent);font-size:2.2rem;">Loading Breaks...</div>';
            try {
                const res = await fetch(`${API_URL}/items`);
                const items = await res.json();
                container.innerHTML = '';
                if (!items.length) { container.innerHTML = '<p style="text-align:center;color:#aaa;font-size:1.7rem;">No active breaks — next one soon!</p>'; return; }
                items.forEach(item => {
                    const card = document.createElement('div');
                    card.className = 'item-card';
                    const img = item.image || 'https://assets.pokemon.com/assets/cms2/img/misc/trading-card-games/cards/tcg_default_card.png';
                    const btn = item.stock > 0 && item.googleFormLink ? `<a href="${item.googleFormLink}" target="_blank" class="action-button">JOIN BREAK!</a>` : `<div class="out-of-stock">SOLD OUT</div>`;
                    card.innerHTML = `<img src="${img}" alt="${item.name}" class="item-image" loading="lazy">
                        <div class="card-content">
                            <h3>${item.name}</h3>
                            <p class="description">${item.description}</p>
                            <div class="item-details">
                                <span class="item-price">$${item.price.toFixed(2)}</span>
                                <span class="item-stock">Spots: ${item.stock}</span>
                            </div>
                            ${btn}
                        </div>`;
                    container.appendChild(card);
                });
            } catch {
                container.innerHTML = '<p style="text-align:center;color:#ff4444;">Failed to load — refresh!</p>';
            }
        }

        // NEW & IMPROVED YOUTUBE LOADER
        async function loadYouTubeVideos() {
            const container = document.getElementById('youtube-videos');
            container.innerHTML = '<div style="text-align:center;padding:5rem;color:var(--accent);font-size:1.8rem;">Loading latest videos...</div>';

            const proxy = 'https://api.allorigins.ml/raw?url=';

            try {
                const feedUrl = `${proxy}${encodeURIComponent('https://www.youtube.com/feeds/videos.xml?channel_id=' + CHANNEL_ID)}`;
                const xmlText = await (await fetch(feedUrl)).text();
                const xml = new DOMParser().parseFromString(xmlText, "application/xml");
                if (xml.querySelector("parsererror")) throw new Error("Bad feed");

                const entries = Array.from(xml.querySelectorAll("entry"));

                let liveVideo = null;
                let upcomingVideo = null;
                const finishedVideos = [];

                for (const entry of entries) {
                    const videoId = entry.querySelector("yt\\:videoId, videoId")?.textContent;
                    const title = entry.querySelector("title")?.textContent || "Untitled";

                    if (!videoId) continue;

                    // Check if maxresdefault.jpg exists → if not, it's live or upcoming
                    const maxresCheck = await fetch(`${proxy}${encodeURIComponent('https://i.ytimg.com/vi/' + videoId + '/maxresdefault.jpg')}`, { method: 'HEAD' }).catch(() => ({ ok: false }));
                    const isLiveOrUpcoming = !maxresCheck.ok;

                    if (isLiveOrUpcoming) {
                        const liveThumbCheck = await fetch(`${proxy}${encodeURIComponent('https://i.ytimg.com/vi/' + videoId + '/hqdefault_live.jpg')}`, { method: 'HEAD' }).catch(() => ({ ok: false }));
                        const video = { videoId, title, isLive: liveThumbCheck.ok };
                        if (video.isLive) liveVideo = video;
                        else upcomingVideo = video;
                    } else {
                        finishedVideos.push({ videoId, title });
                    }
                }

                const toDisplay = [];

                if (liveVideo) toDisplay.push({ ...liveVideo, badge: "LIVE NOW", badgeClass: "live-now" });
                else if (upcomingVideo) toDisplay.push({ ...upcomingVideo, badge: "UPCOMING", badgeClass: "" });

                // Add up to 2 finished videos (or 3 if nothing live/upcoming)
                const finishedCount = toDisplay.length > 0 ? 2 : 3;
                finishedVideos.slice(0, finishedCount).forEach(v => toDisplay.push(v));

                container.innerHTML = '';
                toDisplay.slice(0, 3).forEach(video => {
                    const thumb = video.isLive || (video.badge === "UPCOMING") 
                        ? `https://i.ytimg.com/vi/${video.videoId}/hqdefault_live.jpg`
                        : `https://i.ytimg.com/vi/${video.videoId}/maxresdefault.jpg`;

                    const card = document.createElement('div');
                    card.className = 'yt-video';
                    card.onclick = () => window.open(`https://www.youtube.com/watch?v=${video.videoId}`, '_blank');
                    card.innerHTML = `
                        <img src="${thumb}" alt="${video.title}" class="yt-thumb" loading="lazy">
                        <div class="play-button">Play</div>
                        ${video.badge ? `<div class="upcoming-badge ${video.badgeClass}">${video.badge}</div>` : ''}
                        <div class="yt-overlay"><div class="yt-title">${video.title}</div></div>
                    `;
                    container.appendChild(card);
                });

            } catch (err) {
                console.error(err);
                container.innerHTML = `<div style="text-align:center;padding:4rem;"><a href="https://www.youtube.com/@pokeballermike" target="_blank" style="color:var(--accent);font-size:1.6rem;font-weight:800;text-decoration:underline;">Watch @pokeballermike →</a></div>`;
            }
        }
document.getElementById('store-content').addEventListener('click', e => {
                if (e.target.classList.contains('item-image')) {
                    lightboxImg.src = e.target.src;
                    overlay.classList.add('show');
                }
            });

            overlay.addEventListener('click', () => {
                overlay.classList.remove('show');
                setTimeout(() => lightboxImg.src = '', 300);
            });
        });
    </script>
</body>
</html>
        
