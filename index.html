<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PBM Breaks - The Crystal League</title>
    <link rel="icon" type="image/svg+xml" href="https://upload.wikimedia.org/wikipedia/commons/5/53/Pok%C3%A9_Ball_icon.svg">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800;900&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <style>
        :root {
            --bg: #050510;
            --cyan: #00ffe7;
            --purple: #bd00ff;
            --gold: #ffd700;
            --glass: rgba(20,20,40,0.75);
        }
        * { margin:0; padding:0; box-sizing:border-box; }
        body {
            font-family: 'Inter', sans-serif;
            background: var(--bg);
            color: white;
            min-height: 100vh;
            overflow-x: hidden;
        }
        body::before {
            content:''; position:fixed; inset:0; z-index:-10;
            background: 
                radial-gradient(circle at 50% 40%, rgba(0,255,231,0.08), transparent 60%),
                linear-gradient(to bottom, #050510, #0f0520);
        }
        .particles {
            position:fixed; inset:0; pointer-events:none; z-index:-1; opacity:0.4;
            background-image:
                radial-gradient(1px 1px at 25% 35%, var(--cyan), transparent),
                radial-gradient(1px 1px at 75% 65%, var(--purple), transparent);
            background-size: 120px 120px;
            animation: drift 70s linear infinite;
        }
        @keyframes drift { to { background-position: 0 -1000px; } }

        /* Background Pokémon */
        .poke-bg { position:fixed; pointer-events:none; z-index:-5; opacity:0.4; will-change:transform; }
        .p-suicune { top:50%; left:50%; transform:translate(-50%,-50%); width:clamp(600px,80vw,1200px); opacity:0.14; filter:drop-shadow(0 0 100px rgba(0,255,231,0.4)); animation:breathe 10s infinite; }
        /* ... rest of your Pokémon ... */

        header { text-align:center; padding:6rem 1rem 4rem; }
        .header-logo { width:140px; filter:drop-shadow(0 0 40px var(--cyan)); animation:float 7s infinite; }
        h1 {
            font-size:clamp(4.5rem,12vw,8rem);
            font-weight:900;
            letter-spacing:-5px;
            text-transform:uppercase;
            background:linear-gradient(90deg,#00ffe7,#fff,#bd00ff,#00ffe7);
            -webkit-background-clip:text;
            -webkit-text-fill-color:transparent;
            text-shadow:0 0 60px rgba(0,255,231,0.7);
            animation:shine 10s ease-in-out infinite;
        }
        @keyframes shine {
            0%,100% { text-shadow:0 0 60px rgba(0,255,231,0.7); }
            50% { text-shadow:0 0 80px rgba(189,0,255,0.8); }
        }
        @keyframes breathe { 0%,100%{scale:1;opacity:opacity:0.14} 50%{scale:1.03;opacity:0.19} }
        @keyframes float { 0%,100%{transform:translateY(0)} 50%{transform:translateY(-20px)} }

        main {
            max-width:1400px;
            margin:2rem auto 6rem;
            padding:2rem;
        }

        /* ========== NEW INSANE CARD DESIGN ========== */
        .card {
            position:relative;
            border-radius:26px;
            overflow:hidden;
            background:var(--glass);
            backdrop-filter:blur(20px);
            border:1px solid rgba(0,255,231,0.2);
            transition:all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-shadow:0 15px 40px rgba(0,0,0,0.6);
        }
        .card:hover {
            transform:translateY(-16px) scale(1.03);
            box-shadow:0 30px 80px rgba(0,255,231,0.35), 0 0 100px rgba(189,0,255,0.2);
            border-color:rgba(0,255,231,0.6);
        }
        .card::before {
            content:''; position:absolute; inset:0;
            background:linear-gradient(135deg, rgba(0,255,231,0.15), transparent 40%, rgba(189,0,255,0.15));
            opacity:0; transition:opacity 0.6s;
            pointer-events:none;
        }
        .card:hover::before { opacity:1; }

        /* Video Feed */
        .yt-container {
            display:grid;
            gap:32px;
            grid-template-columns:1fr;
        }
        @media(min-width:900px) { .yt-container { grid-template-columns:1fr 1fr; } }
        .video-card { aspect-ratio:16/9; cursor:pointer; }
        .video-thumb { width:100%; height:100%; object-fit:cover; transition:transform 0.8s; }
        .card:hover .video-thumb { transform:scale(1.1); }
        .video-overlay {
            position:absolute; inset:0;
            background:linear-gradient(to top, rgba(5,5,16,0.95), transparent 40%);
            display:flex; flex-direction:column; justify-content:flex-end; padding:32px;
        }
        .video-title {
            font-size:1.25rem; font-weight:800; text-shadow:0 3px 15px black;
        }

        /* Store Breaks */
        .store-grid {
            display:grid;
            gap:32px;
            grid-template-columns:repeat(auto-fit, minmax(340px,1fr));
        }
        .break-card { height:100%; display:flex; flex-direction:column; }
        .break-img-box { height:340px; overflow:hidden; position:relative; }
        .break-img { width:100%; height:100%; object-fit:cover; transition:transform 0.8s; }
        .card:hover .break-img { transform:scale(1.12); }
        .break-content { padding:1.8rem; flex:1; display:flex; flex-direction:column; justify-content:space-between; }

        /* Labels & Buttons */
        .badge {
            position:absolute; top:18px; left:18px; padding:10px 18px; border-radius:14px;
            font-weight:900; font-size:0.85rem; letter-spacing:1px; text-transform:uppercase;
            backdrop-filter:blur(12px); border:1px solid rgba(255,255,255,0.3);
            box-shadow:0 8px 20px rgba(0,0,0,0.5);
        }
        .upcoming { background:rgba(255,215,0,0.95); color:#000; animation:pulse 2s infinite; }
        .latest { background:rgba(189,0,255,0.95); color:#fff; }
        .hunt { background:rgba(0,238,255,0.95); color:#000; }
        .tag-msrp { background:rgba(0,255,157,0.95); color:#000; }
        .tag-bundle { background:linear-gradient(135deg,#111,#333); color:var(--gold); border:2px solid var(--gold); position:absolute; top:18px; right:18px; padding:8px 16px; border-radius:10px; font-size:0.8rem; }

        .price { font-size:2.2rem; font-weight:900; color:var(--cyan); text-shadow:0 0 20px var(--cyan); }
        .buy-btn {
            padding:1.1rem; border-radius:14px; background:linear-gradient(90deg,var(--cyan),var(--purple));
            text-align:center; font-weight:900; text-transform:uppercase; letter-spacing:1.5px;
            box-shadow:0 12px 30px rgba(0,255,231,0.4); transition:0.4s; text-decoration:none; color:white;
        }
        .buy-btn:hover { transform:translateY(-4px); box-shadow:0 20px 50px rgba(189,0,255,0.6); }
        .sold-out { background:#111 !important; color:#555; cursor:not-allowed; }

        footer { text-align:center; padding:4rem 0; color:#666; font-size:0.9rem; }
    </style>
</head>
<body>
    <div class="particles"></div>

    <!-- Background Pokémon (keep all your images) -->
    <img src="https://assets.pokemon.com/assets/cms2/img/pokedex/full/245.png" class="poke-bg p-suicune">
    <img src="https://assets.pokemon.com/assets/cms2/img/pokedex/full/384.png" class="poke-bg">
    <img src="https://assets.pokemon.com/assets/cms2/img/pokedex/full/006.png" class="poke-bg">
    <img src="https://assets.pokemon.com/assets/cms2/img/pokedex/full/094.png" class="poke-bg">
    <img src="https://assets.pokemon.com/assets/cms2/img/pokedex/full/282.png" class="poke-bg">
    <img src="https://assets.pokemon.com/assets/cms2/img/pokedex/full/134.png" class="poke-bg">
    <img src="https://assets.pokemon.com/assets/cms2/img/pokedex/full/104.png" class="poke-bg">
    <img src="https://assets.pokemon.com/assets/cms2/img/pokedex/full/172.png" class="poke-bg">
    <img src="https://assets.pokemon.com/assets/cms2/img/pokedex/full/129.png" class="poke-bg">

    <header>
        <img src="https://assets.pokemon.com/assets/cms2/img/pokedex/full/245.png" class="header-logo">
        <h1>PBM BREAKS</h1>
    </header>

    <main>
        <div class="yt-container" id="yt-container">
            <div style="grid-column:1/-1; text-align:center; padding:4rem; color:#666;">Loading Crystal Feed...</div>
        </div>

        <div class="store-grid" id="store-container">
            <div style="grid-column:1/-1; text-align:center; padding:4rem; color:#666;">Summoning Drops...</div>
        </div>
    </main>

    <footer>
        <p>© 2025 PBM Breaks • Not affiliated with Nintendo • Forged in the Crystal Realm</p>
    </footer>

    <script>
        const API_URL = 'https://pokeballer-worker.kronborgnielsen.workers.dev/api';

        async function loadVideos() {
            const container = document.getElementById('yt-container');
            try {
                const res = await fetch(`${API_URL}/youtube`);
                const text = await res.text();
                const doc = new DOMParser().parseFromString(text, "text/xml");
                const entries = Array.from(doc.querySelectorAll("entry")).slice(0,20);

                let stream = null, hunt = null;
                for (let e of entries) {
                    const t = e.querySelector("title").textContent.toLowerCase();
                    if ((t.includes('stream') || t.includes('live') || t.includes('break')) && !stream) {
                        stream = { id: e.querySelector("videoId").textContent, title: e.querySelector("title").textContent, upcoming: t.includes('upcoming') };
                    } else if (!t.includes('stream') && !t.includes('live') && !hunt) {
                        hunt = { id: e.querySelector("videoId").textContent, title: e.querySelector("title").textContent };
                    }
                }

                container.innerHTML = '';
                [stream, hunt].forEach(v => {
                    if (!v) return;
                    const badge = v === stream
                        ? (v.upcoming ? '<div class="badge upcoming">UPCOMING LIVE</div>' : '<div class="badge latest">LATEST BREAK</div>')
                        : '<div class="badge hunt">LATEST HUNT</div>';

                    container.innerHTML += `
                        <div class="card video-card" onclick="window.open('https://youtube.com/watch?v=${v.id}')">
                            <img src="https://i.ytimg.com/vi/${v.id}/maxresdefault.jpg" class="video-thumb">
                            ${badge}
                            <div class="video-overlay">
                                <div class="video-title">${v.title}</div>
                            </div>
                        </div>`;
                });
            } catch(e) {
                container.innerHTML = `<a href="https://youtube.com/@PokeballerMike" target="_blank" class="buy-btn" style="margin:2rem auto;display:block;width:fit-content;padding:1.2rem 3rem;">VISIT CHANNEL</a>`;
            }
        }

        async function loadStore() {
            const container = document.getElementById('store-container');
            try {
                const res = await fetch(`${API_URL}/items`);
                const items = await res.json();
                items.sort((a,b) => (b.createdAt||0) - (a.createdAt||0));

                container.innerHTML = '';
                items.forEach(i => {
                    const tag = i.type==='bundle' ? '<div class="tag-bundle">BUNDLE</div>' : '<div class="tag-msrp">MSRP</div>';
                    const btn = i.stock > 0 && i.googleFormLink
                        ? `<a href="${i.googleFormLink}" target="_blank" class="buy-btn">JOIN BREAK</a>`
                        : `<div class="buy-btn sold-out">SOLD OUT</div>`;

                    container.innerHTML += `
                        <div class="card break-card">
                            ${tag}
                            <div class="break-img-box">
                                <img src="${i.image || 'https://assets.pokemon.com/assets/cms2/img/misc/trading-card-games/cards/tcg_default_card.png'}" class="break-img">
                            </div>
                            <div class="break-content">
                                <div>
                                    <h3>${i.name}</h3>
                                    <p style="color:#aaa;margin:0.8rem 0 1.5rem;">${i.description || ''}</p>
                                    <div style="display:flex;justify-content:space-between;align-items:end;">
                                        <div class="price">$${Number(i.price).toFixed(2)}</div>
                                        <div style="background:rgba(255,255,255,0.07);padding:8px 14px;border-radius:8px;font-size:0.9rem;">${i.stock} spots</div>
                                    </div>
                                </div>
                                ${btn}
                            </div>
                        </div>`;
                });
            } catch(e) { console.error(e); }
        }

        window.onload = () => { loadVideos(); loadStore(); };
    </script>
</body>
</html>
