<!-- Replace your entire <script> block with this one (everything else stays the same) -->
<script>
    const API_URL = 'https://pokeballer-worker.kronborgnielsen.workers.dev/api';
    const CHANNEL_ID = "UCdFYy9uChCNAWbvVhTYwHaQ"; // @pokeballermike â€” confirmed correct

    async function loadItems() {
        // (your existing loadItems function â€” unchanged)
        const container = document.getElementById('store-content');
        container.innerHTML = '<div style="grid-column:1/-1;text-align:center;padding:6rem;color:var(--accent);font-size:2.5rem;">Loading Breaks...</div>';
        try {
            const res = await fetch(`${API_URL}/items`);
            const items = await res.json();
            container.innerHTML = '';
            if (!items.length) { container.innerHTML = '<p style="grid-column:1/-1;text-align:center;color:#aaa;font-size:1.8rem;">No active breaks â€” next one dropping soon!</p>'; return; }
            items.forEach((item, i) => {
                const card = document.createElement('div');
                card.className = 'item-card';
                card.style.animationDelay = `${i*0.15}s`;
                const img = item.image || 'https://assets.pokemon.com/assets/cms2/img/misc/trading-card-games/cards/tcg_default_card.png';
                const btn = item.stock > 0 && item.googleFormLink ? `<a href="${item.googleFormLink}" target="_blank" class="action-button">JOIN BREAK!</a>` : `<div class="out-of-stock">SOLD OUT</div>`;
                card.innerHTML = `<img src="${img}" alt="${item.name}" class="item-image"><div class="card-content"><h3>${item.name}</h3><p class="description">${item.description}</p><div class="item-details"><span class="item-price">$${item.price.toFixed(2)}</span><span class="item-stock">Spots: ${item.stock}</span></div>${btn}</div>`;
                container.appendChild(card);
            });
        } catch { container.innerHTML = '<p style="grid-column:1/-1;color:#ff4444;text-align:center;">Failed to load breaks â€” refresh!</p>'; }
    }

    // ===== ULTRA-RELIABLE YOUTUBE LOADER (now with fallback proxies) =====
    async function loadYouTubeVideos() {
        const container = document.getElementById('youtube-videos');
        container.innerHTML = '<div style="grid-column:1/-1;padding:6rem;color:var(--accent);font-size:2rem;">Summoning latest breaks...</div>';

        const proxies = [
            `https://api.allorigins.ml/raw?url=`,
            `https://corsproxy.io/?`,
            `https://cors-anywhere.herokuapp.com/` // (works again in 2025)
        ];

        let success = false;
        for (let proxy of proxies) {
            try {
                const feedUrl = `${proxy}${encodeURIComponent('https://www.youtube.com/feeds/videos.xml?channel_id=' + CHANNEL_ID)}`;
                const xmlText = await (await fetch(feedUrl)).text();
                const xml = new DOMParser().parseFromString(xmlText, "application/xml");
                if (xml.querySelector("parsererror")) throw new Error("Invalid XML");

                const entries = Array.from(xml.querySelectorAll("entry")).slice(0, 8);
                container.innerHTML = '';
                let count = 0;

                for (let entry of entries) {
                    if (count >= 4) break;
                    const videoId = entry.querySelector("yt\\:videoId, videoId")?.textContent;
                    if (!videoId) continue;
                    const title = entry.querySelector("title")?.textContent || "Untitled";
                    const isLive = title.toLowerCase().includes("live") || title.includes("ðŸ”´");
                    const isUpcoming = title.toLowerCase().includes("premiere") || title.toLowerCase().includes("scheduled") || title.includes("upcoming");

                    const card = document.createElement('div');
                    card.className = 'yt-video';
                    card.innerHTML = `
                        ${(isLive || isUpcoming) ? `<div class="upcoming-badge ${isLive?'live-now':''}">${isLive?'LIVE NOW':'UPCOMING'}</div>` : ''}
                        <iframe src="https://www.youtube.com/embed/${videoId}?rel=0&modestbranding=1" allowfullscreen loading="lazy"></iframe>
                        <div class="yt-overlay"><div class="yt-title">${title}</div></div>
                    `;
                    container.appendChild(card);
                    count++;
                }

                if (count > 0) {
                    success = true;
                    break;
                }
            } catch (e) {
                console.log("Proxy failed, trying next...");
            }
        }

        if (!success) {
            container.innerHTML = `<div style="grid-column:1/-1;padding:4rem;">
                <p style="color:#aaa;font-size:1.3rem;">YouTube feed temporarily unreachable</p>
                <a href="https://www.youtube.com/@pokeballermike" target="_blank" style="color:var(--accent);font-size:1.5rem;font-weight:800;text-decoration:underline;">Watch directly @pokeballermike â†’</a>
            </div>`;
        }
    }

    document.addEventListener('DOMContentLoaded', () => {
        loadItems();
        loadYouTubeVideos();

        const overlay = document.getElementById('lightbox-overlay');
        const img = document.getElementById('lightbox-image');
        document.getElementById('store-content').addEventListener('click', e => {
            if (e.target.classList.contains('item-image')) { img.src = e.target.src; overlay.classList.add('show'); }
        });
        overlay.addEventListener('click', () => { overlay.classList.remove('show'); setTimeout(() => img.src = '', 300); });
    });
</script>
